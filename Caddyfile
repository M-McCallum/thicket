{
	email admin@thicket.app
}

thicket.app {
	# API and WebSocket
	handle /api/* {
		reverse_proxy backend:8080
	}

	handle /ws {
		reverse_proxy backend:8080
	}

	# LiveKit
	handle /livekit/* {
		reverse_proxy livekit:7880
	}

	# Web frontend (SPA fallback)
	handle {
		reverse_proxy web:80
	}

	# Security headers
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		Referrer-Policy "strict-origin-when-cross-origin"
		Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self' wss://*.thicket.app"
		-Server
	}

	# Rate limiting
	rate_limit {
		zone global {
			key {remote_host}
			events 100
			window 1m
		}
	}
}
